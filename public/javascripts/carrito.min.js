function precioProducto(id_producto, precio, id_pedido, id_cliente) {
    var cantidad_producto = $('#cantidad' + id_producto).val();
    var precio_producto_total = precio * cantidad_producto;
    //console.log(total);
    $('#totalproducto' + id_producto).text(precio_producto_total);

    $.ajax({
        url: "/carrito/actualizarDatos",
        type: "post",
        data: {
            id_pedido,
            id_producto,
            cantidad_producto,
            precio_producto_total,
            id_cliente
        },
        success: function (response) {
            console.log('===>');
            console.log(response);
            $('#totalpago' + id_pedido).text(response.data[0].total_pago + " Bs");
        },
        error: function (jqXHR, textStatus, errorThrown) {
            console.log(textStatus, errorThrown);
        }
    });
    //console.log(cantidad);
}

function eliminarProducto(id_pedido, id_producto, id_cliente) {
    console.log("eliminar");
    console.log("id_pedido: " + id_pedido + " - id_producto: " + id_producto);
    $("#fila" + id_pedido + "" + id_producto).remove();
    $.ajax({
        url: "/carrito/eliminarProducto",
        type: "post",
        data: {
            id_pedido,
            id_producto,
            id_cliente
        },
        success: function (response) {
            console.log('===>');
            console.log(response);
            $('#totalpago' + id_pedido).text(response.data[0].total_pago + " Bs");
        },
        error: function (jqXHR, textStatus, errorThrown) {
            console.log(textStatus, errorThrown);
        }
    });
}

$("#billing-phone").change(function () {
    if ($('#billing-phone').val().length === 0 || $('#billing-phone').val().length < 4 || $('#billing-phone').val().length >8) {
        cssInputInvalid('billing-phone', 'Campo requerido, mínimo 4 caracteres máximo 8');
    } else {
        //cssInputValid('billing-phone');
        $('#error-billing-phone').hide();
    }
});

$("#billing-address").change(function () {
    if ($('#billing-address').val().length === 0 || $('#billing-address').val().length < 5) {
        cssInputInvalid('billing-address', 'Campo requerido, mínimo 5 caracteres');
    } else {
        //cssInputValid('billing-address');
        $('#error-billing-address').hide();
    }
});

$("#billing-city").change(function () {
    if ($('#billing-city').val().length === 0 || $('#billing-city').val().length < 4) {
        cssInputInvalid('billing-city', 'Campo requerido, mínimo 4 caracteres');
    } else {
        //cssInputValid('billing-city');
        $('#error-billing-city').hide();
    }
});

function cssInputInvalid(id, msg) {
    $('#'+id).css('border-color', '#fa5c7c');
    $('#'+id).css('padding-right', 'calc(1.5em + 0.9rem)');
    $('#'+id).css('background-image', `url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12' width='12' height='12' fill='none' stroke='%23fa5c7c'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath stroke-linejoin='round' d='M5.8 3.6h.4L6 6.5z'/%3e%3ccircle cx='6' cy='8.2' r='.6' fill='%23fa5c7c' stroke='none'/%3e%3c/svg%3e")`);
    $('#'+id).css('background-repeat', 'no-repeat');
    $('#'+id).css('background-position', 'right calc(0.375em + 0.225rem) center');
    $('#'+id).css('background-size', 'calc(0.75em + 0.45rem) calc(0.75em + 0.45rem)');
    $('#error-'+id).show();
    $('#error-'+id).text(msg);
}

function cssInputValid(id) {
    $('#'+id).css('border-color', '#0acf97');
    $('#'+id).css('padding-right', 'calc(1.5em + 0.9rem)');
    $('#'+id).css('background-image', `url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 8 8'%3e%3cpath fill='%230acf97' d='M2.3 6.73L.6 4.53c-.4-1.04.46-1.4 1.1-.8l1.1 1.4 3.4-3.8c.6-.63 1.6-.27 1.2.7l-4 4.6c-.43.5-.8.4-1.1.1z'/%3e%3c/svg%3e")`);
    $('#'+id).css('background-repeat', 'no - repeat');
    $('#'+id).css('background-position', 'right calc(0.375em + 0.225rem) center');
    $('#'+id).css('background-size', 'calc(0.75em + 0.45rem) calc(0.75em + 0.45rem)');
    $('#error-'+id).hide();
}

/* Compra */
function continuarPago(id_cliente, id_pedido) {
    if ($('#billing-phone').val().length === 0 || $('#billing-phone').val().length < 4 || $('#billing-phone').val().length > 8) {
        cssInputInvalid('billing-phone', 'Campo requerido, mínimo 4 caracteres máximo 8');
        return;
    }
    if ($('#billing-address').val().length === 0 || $('#billing-address').val().length < 5) {
        cssInputInvalid('billing-address', 'Campo requerido, mínimo 5 caracteres');
        return;
    }
    if ($('#billing-city').val().length === 0 || $('#billing-city').val().length < 4) {
        cssInputInvalid('billing-city', 'Campo requerido, mínimo 4 caracteres');
        return;
    }

    var departamento = $('#billing-city').val();
    var telefono = $('#billing-phone').val();
    var direccion_entrega = $('#billing-address').val();
    $('#info-alert-modal').show();
    $.ajax({
        url: "/compra/actualizarDatos",
        type: "post",
        data: { 
            id_cliente,
            id_pedido,
            departamento,
            telefono,
            direccion_entrega
        },
        success: function (response) {
            $('#info-alert-modal').hide();
            $('#nav-shipping-information').removeClass('active');
            $('#nav-payment-information').addClass('active');
            $('#shipping-information').removeClass('active');
            $('#payment-information').addClass('active');
            console.log('===>');
            console.log(response);
            if (response.ok) {
                $.NotificationApp.send("Bien hecho!", response.msg, "bottom-right", "rgba(0,0,0,0.2)", "success");
            } else {
                $.NotificationApp.send("Aviso!", response.msg, "bottom-right", "rgba(0,0,0,0.2)", "warning");
            }
        },
        error: function (jqXHR, textStatus, errorThrown) {
            $('#info-alert-modal').hide();
            console.log(textStatus, errorThrown);
        }
    });
    
}

/* Completar orden */
function completarOrden(id_pedido) {
    console.log("completarOrden", id_pedido);
    //$('#loading').show();
    $.ajax({
        url: "/compra/completarOrden",
        type: "post",
        data: {
            id_pedido
        },
        success: function (response) {
            console.log('===>');
            console.log(response);
            if (response.ok) {
                $.NotificationApp.send("Bien hecho!", response.msg, "bottom-right", "rgba(0,0,0,0.2)", "success");
            } else {
                $.NotificationApp.send("Aviso!", response.msg, "bottom-right", "rgba(0,0,0,0.2)", "warning");
            }
            setTimeout(() => {
                window.location.href = '/';
            }, "5000")
        },
        error: function (jqXHR, textStatus, errorThrown) {
            $('#loading').hide();
            console.log(textStatus, errorThrown);
        }
    });
    $('#loading').hide();
}
